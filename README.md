# Внутренний сайт компании.
## Основной сайт
### Библиотеки: 
1. FastAPI, pydantic, uvicorn, starlette - для работы с сокетами и соединением по локальному айпи;
2. SQLAlchemy, asyncpg - ORM и движок для работы с БД (postgres);
3. Jinja2Templates - компиляция html страницы по шаблону с использованием кода;
4. dotenv - подкачка значений из .env переменных

### Маршрут по серверу
**Общее**
| Папка             | Описание                  |
| ----------------- | ------------------------- |
| **migrations**    | Папка для миграций по БД  |
| **server_app**    | Папка с основным сервером |
| **dashboard_app** | Папка с сервером дашборда |

**Файлы из migrations**
| Файл              | Описание                               |
| ----------------- | -------------------------------------- |
| **versions**      | Папка с версиями БД                    |
| **env.py**        | Настройки алембика, добавление классов |

**Файлы из dashboard_app**
| Файл                  | Описание                               |
| --------------------- | -------------------------------------- |
| **dash_app.py**       | Основной файл                          |
| **assets/style.css**  | Файл с CSS стилями                     |
| **data_reciever.py**  | Подгрузка данных                       |

**Файлы из server_app**
| Файл                | Описание                                                                                              |
| ------------------- | ----------------------------------------------------------------------------------------------------- |
| **bad_templates**   | **Старые шаблоны. Прикольные фичи**                                                                   |
| app.py              | Основной файл сервера, запуск и инициализация                                                         |
| **database**        | **Папка для базы данных**                                                                             |
| database.py         | Инициализации БД и создание сессий                                                                    |
| model.py            | Общие модели БД. Не работает                                                                          |
| user_manager.py     | Функции для fastapi-users                                                                             |
| **src/auth**        | **Ручки авторизации**                                                                                 |
| **src/dashboard**   | **Ручки дашборда**                                                                                    |
| **src/home**        | **Ручки основной страницы с отделами и отдела**                                                       |
| **src/staff**       | **Ручки для приложений, где забрать данные, положить данные**                                         |
| **src/utils**       | **Небольшие штуки, которые нужны везде, но не понятно, где их инициализировать (роли пользователей)** |
| **static**          | **Статические файлы для отоброжения html, (css, js, img, также можно видосики и другое)**             |
| **templates**       | **Шаблоны для Jinja2Templates. Можно сделать еще одну папку для html обычного**                       |
| **fill_tables**     | **Скрипты для заполнения таблиц, из эксельки, рандомными значениями. Очистить БД**                    |

### Общая реализация / подсказки
- Запускаешь *app.py*. Он подгружает все ручки, статические файлы, и БДшку. Ты заходишь по ручке, сервер отдает тебе html странички.
- Для того, чтобы создать новую ревизию, к примеру, чтобы добавить новый столбик в БД, стоит выполнить код.
1. Создать новую генерацию.
2. Обновить БД до последней генерации.
```
alembic revision --autogenerate -m *название_ревизии*
alembic upgrade head
```

### Установка
```
git clone https://github.com/iriskison/server
```
Все проблемы гугятся изи. Обычно надо будет добавить устройство как разрешенное для установки данного репозитория.
```
pip install -r requirements.txt
```
Далее надо провести миграцию в БД. Для этого в миграциях и в database надо указать айпишник, логин и пароль для postgres. После этого всего, нужно запустить последнее обновление БД.
```
alembic init *имя_папки*
alembic revision --autogenerate -m *название_ревизии*
alembic upgrade head
```
Чтобы запустить сервер надо запустить *app.py* файл. В будущем надо будет сделать это через uvicorn или gunicorn. Короче с этим вопросом надо поработать.
```
venv\Scripts\activate
python server_app\app.py
```

**Запуск Дашборда**  
После того, как вы сделали все действия из списка выше, можно запускать дашборд. Он запускается паралельно с сервером, если сервер не будет запущен, дашборд не сможет получить данные. Его запускать с помощью dash_app.py. Это тоже надо переделать и как-то создавать нормально, но это когда все будет работать.

## Работа с приложениями.
В приложении кадров есть примерный вариант, как может это работать. В server_app/src/staff есть ручки для приложения кадров. Кадры через библиотеку request кидает запросы get/post на сервер с нужными данными в *.json и возвращаются данные тоже в *.json.
